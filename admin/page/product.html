<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Cars - Admin Dashboard</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="../styles/product.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Specific overrides for the Low Stock badge */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .instock { background: #dcfce7; color: #166534; }
        .lowstock { background: #fee2e2; color: #991b1b; }
        .img-preview { width: 50px; height: 35px; object-fit: cover; border-radius: 4px; }
        #logoutLoading {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); z-index: 9999;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-bar-container { width: 200px; height: 4px; background: #e2e8f0; border-radius: 2px; margin-bottom: 10px; overflow: hidden; }
        #p-bar-fill { width: 0%; height: 100%; background: #3b82f6; transition: width 1s linear; }
    </style>
</head>
<body>

    <div id="logoutLoading">
        <div class="loader-bar-container"><div id="p-bar-fill"></div></div>
        <span style="font-size: 12px; font-weight: 600; color: #64748b; text-transform: uppercase;">Signing Out...</span>
    </div>

    <nav class="sidebar">
        <div class="logo">
            <i class="fa-solid fa-car-side"></i>
            <span>Admin Product</span>
        </div>
        <ul class="nav-links">
            <li><a href="../admin.html"><i class="fa-solid fa-house"></i> Dashboard</a></li>
            <li class="active"><a href="product.html"><i class="fa-solid fa-box"></i> Products</a></li>
            <li><a href="order.html"><i class="fa-solid fa-receipt"></i> Orders</a></li>
            <li><a href="customer.html"><i class="fa-solid fa-users"></i> Customers</a></li>
            <li><a href="setting.html"><i class="fa-solid fa-gear"></i> Settings</a></li>
        </ul>
        <div class="logout">
            <a href="javascript:void(0)" id="logoutBtn"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
        </div>
    </nav>

    <main class="main-content">
        <header>
            <div class="search-bar">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="carSearch" placeholder="Search by model or brand..." onkeyup="searchCars()">
            </div>
            <div class="user-info">
                <i class="fa-solid fa-bell" style="margin-right: 15px; color: #64748b; cursor: pointer;"></i>
                <div class="profile">
                    <div class="user-avatar-premium">N</div>
                    <div class="user-info-text">
                        <span class="name">Narith</span>
                        <span class="role">Administrator</span>
                    </div>
                </div>
            </div>
        </header>

        <section class="management-section">
            <div class="section-header">
                <h2>Vehicle Inventory</h2>
                <div class="header-actions">
                    <button class="add-btn" onclick="toggleModal()">+ Add New Car</button>
                    <div class="filter-actions" style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="filter-btn" onclick="filterCars('All')">All</button>
                        <button class="filter-btn" onclick="filterCars('SUV')">SUVs</button>
                        <button class="filter-btn" onclick="filterCars('Luxury')">Luxury</button>
                        <button class="filter-btn" onclick="filterCars('Electric')">Electric</button>
                    </div>
                </div>
            </div>

            <table class="product-table">
                <thead>
                    <tr>
                        <th>N.O</th> <th>Image</th>
                        <th>Car Model</th> <th>Brand</th>
                        <th>Category</th> <th>Price</th>
                        <th>Stock</th> <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="car-list-body"></tbody>
            </table>
        </section>
    </main>

    <div id="productModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Add New Vehicle</h3>
            <div style="text-align: center; margin-bottom: 10px;">
                <img id="p-preview" src="https://via.placeholder.com/150x80?text=No+Image" style="width: 150px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd;">
            </div>
            <div class="modal-input-group">
                <label>Image URL</label>
                <input type="text" id="p-image" placeholder="https://example.com/car.jpg" oninput="updatePreview()">
            </div>
            <div style="display: flex; gap: 15px;">
                <div class="modal-input-group" style="flex: 1;">
                    <label>Car Model *</label>
                    <input type="text" id="p-name">
                </div>
                <div class="modal-input-group" style="flex: 1;">
                    <label>Brand *</label>
                    <input type="text" id="p-brand">
                </div>
            </div>
            <div class="modal-input-group">
                <label>Category *</label>
                <select id="p-cat">
                    <option value="" disabled selected>Select category</option>
                    <option value="SUV">SUV</option>
                    <option value="Luxury">Luxury</option>
                    <option value="Electric">Electric</option>
                </select>
            </div>
            <div style="display: flex; gap: 15px;">
                <div class="modal-input-group" style="flex: 1;">
                    <label>Price ($) *</label>
                    <input type="number" id="p-price">
                </div>
                <div class="modal-input-group" style="flex: 1;">
                    <label>Stock *</label>
                    <input type="number" id="p-stock">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="toggleModal()">Cancel</button>
                <button class="add-btn" id="save-btn" onclick="saveCar()">Save Vehicle</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. INITIAL DATA (carProducts) ---
        const defaultProducts = [
            { name: "Tesla Model 3 Performance", brand: "Tesla", price: 45000, category: "Electric", stock: 12, image: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxASEBUSERAVFRUPFRUPFRcQFRYVFRAQFhUWFhUVFRUYHSggGBolHRUVITEhJSkrLi4uFx8zODMtNygtLisBCgoKDg0OFRAQFy0dHR0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSstLS0tLS0tLS0tLi0rK//AABEIAKgBLAMBEQACEQEDEQH/xAAcAAACAwEBAQEAAAAAAAAAAAABAgADBAUGBwj/xABJEAABAwEDBwgFCQUHBQAAAAABAAIDEQQhMQUSQVFhcYEGExRSkaGx0RUiMnLBBzNCU2KCkuHwFiOiwvFDRFRjk7LSNFVzg6P/xAAaAQEBAQEBAQEAAAAAAAAAAAAAAQIDBAUG/8QANhEBAAIBAgMECAYCAQUAAAAAAAECEQMEEjFRBRMhQRQyYXGBkaHRIkJSseHwI8FiBhUzQ1P/2gAMAwEAAhEDEQA/APioC0goCAgKAogoCAimAQGiAqoICKKCBAUQUEQMFQVAQgYBWAwCBggYIhmoGQMFoRGThFFAQgYIGCgNVRKoIgIKBgUBqg8kubYgICgNFUEBQMAiigICAqggICgiAogoIgKBggKAoGC0GCgYIgoGCBgrAZUlEZMEUwUgMqooiKA1RBCoKKlUEqgNUHlgFzbFAUZEIpgiihI0RIgVVEICgKCIgoIgIQMgiBkECB1oFQMEBCMiEU4VgMqIiCFJDBIUwVQyAKCIDVBFUGqCVQSqDzS5uggKpzFRRCBkBCIKqoESDIqBAUQUEQGioKAhQFBEBCoZUMEBCiGCIZFMCqGCoiIKglVFOFQaqolVACUUQUQUBVREEQecC5tyKqioCEBQkQiQKoIRRQFEEIIgYKgoIoIgKCICqpgqhgoCEDIgoCCgYFVBqgKpCBSVOCoJVBKqiVUEBVBBQGqIKCIPPBYbRAQiQZFRGRCNCFUMiiiIgKoKgKoKgiCICgiA1QTPGtUTnQmRBKEFjS44MJ4IOhYsj2ub5uzPcNdA1o3udQd6mVjTtblDa7k3K3520WSLZJaBnDgxrk4obnQvHPw96ehI/wDuNj/1JB382mUnT9sfMW8nZHfNz2WU6orRHXsfmq5Tu7e9mtuSLTCKywSMHWLSWfjFW96uWJrMc2MFBEEqmBEEqgaqglUBqggKoNUHAWGsoiHRURJMiogIVSBRRREQFAwQRUFBFAXXY3ePYmWprMc/BWZUZIZCiheUGiGzEoOlZclVTCO/kzIDXHAHSdQGsnQFZmI5umnpX1JxWF9vyzZLJ6sbGzSjSR6jTu08excuKbcuT2W0tLb+v+K3T7vM5Uy9a5/nZHBuhrataBqoFqKw819xe3niOkeDnAU1LTgsZJswQPntvqAaGmCo22DKUkR/czSR/wDje4NO9uB4pheKY8212U2S/wDUQMeT/aQAQTV1kAZj+La7UXMTzhnlsINXQP5wC8tIzZWD7UdTUbWkjXRMpw9GIFVlKoJVBFVRAaqYQQVBM5XA4YWFgQgKKYIgoqKoIRRQFAUQUBCAoHzKCrjQG8a3bh8cEy3FPOfBW6ensim3F3bo4KY6nFj1fD9/77mcuRkKoLGMqg6Vmsfq5x03BUdCzxC65VHcsUFRnOOaxuLjr1NGkrF9SKvbtNlfXnPKvX7OTl/lIS0xQepGLidLjtOk+C51rNvGz1bjc00InS0PjP8AfP8Avu48GSLYQHts8jgbwQ0knbTHuXTir1eCdtrYzwT4+yQnZMwfvIZGVurIx7BX7wCuXG1ZjnGGMuVZWUuJQDOvO4HuBQFrkFokKosZaDcdRqCMQdYOhBqM4k9v2usNPvjTvx3ouYnmrljLTRwocd40EbEylqzWcSRESqA1VyBVQGquRKpkcZYaFAUBCJAoqKoIRRQQIGCIYILIoi7Ab9AG8m4KTMRzbpp2vOKwszaey3OPWI9Ue6047z2aVOKPOXaNK0erWZnrjw+H3n5KHwSG/NcScScSeKcdep6Lrz48MkNkk6h7lnjr1a9C3H6P2+4dEk6vePNOOvU9B3H6PrH3WxWCQ4MJ3Cvgrx16noWv+n6x926HJsmmN3YU469T0LX/AEfs6JY6gBbmgXYq95Xqeg7j9H7NdhZFe6SQAN+iPafxwA71i2rHk9O37NtNonV8I6OXl7LDnUYDmjQG3BrNm0rnp0zOZerfbuNKkaWn+H/Ufy5dktEQe3nK5jDnEAVrTAdtF2vmazEc3ytpbSprVtq+rHj9nck5Sw6BIeA815I29+sP01u3tp5VtPwj7skmWWPDmubKQ7aKDhWi3GleJjFnh1e0ttrVtW2nac+7w+rkiI9Ur1Zjq+FGleeVZn4SubC+h9V34XeSnFXq1G31v0W+U/YwsslfYdhT2T1aKcdercbPcT/67fKTCxSdUp3lerXoG4/RJ22KTV3jzTvK9T0HX86/WPu0wZGmeaNbU7PyV44lJ2l454j4u1ZeR8woZS1gPXcG17fJXMpXRrE/inPudC32KzZmbNOyo9ksDnFp2EDDYsxEw9GrempGJh5CSOhIBzgMCLqjXQ3reXgtTCuqrA1QSqAoIiOOstoCiZMiojIhGoFUPFG5xo1pJ2LNrRXnLppaOpqzilZl0Ysjuxke1mwXlee25j8sZfY0uxb89a8V9keM/wB+aw2Wzt6zjtNO4Kd5qT7Hf0HZafhibT7/ALYDm2n2WAbxXxV4585Sdvpz6unEfDKxllro7AApOo3XYVnnDQyygLE3mXqrs6Vjx8GyyZNfJ7DSR1j6rBvebkzLcU0/yxn3NbMkxg0fMCerA0yE/eNAO9Zm0O9dC0+OMNcWSmDCz/etUhH/AM4wO9ImUnTiPa6NlgjZ9WD/AJUTR3mpW4mHnvp38nVgdH1ncXU8F0iYePUpfqvlIAq09581t58dXmcqZclYaXcRXxXObTD0U062ct2WrQ7qcYoz4tXOdV6q7TP9lltHOPBDhH6woaRRg8CG3LPfuk9n5YIclZhqKVN3rCo7E9IlyjsqlZz5tLYSMacBRSdTL0023DGMjmu6xU4o6NxS0fmkwD+sUzHRrF/1SSTPGhzt1PiQrHC5aneV5Ra3ux/uYSKN5FSCN5BNNdys2rHJnT09S8TN4mvxif2WiAqd43Ozz5rGteMPBXvWJ7PiXSsWVbQwUbJmj7LWjvpVJ1reUt6fZuh+auffkklutbyM6QgaaSOJ4AABWdT/AJSU2VuKP8NK18/GZn4fhhjtL5NL38XHzSt56sa+2rXOKx8nNlkOkk77/Fd6y+Pq0r0ZJqUBrfU1AbS7Qbrl3rMy+TraVKRExPj0x/tStPOiAgoJVUchYaFEEIooCESWuKygXvu2aSdS5XvPKH1Nrs6zEX1Pk1ttRAzWDNGzE7yuE0jObeL6tdaaxw6ccMCYn/SrfrN/EYhWZiGKxa8+MysigXObvTTShqZHsWc5eiKxDVHZ3m4dwqewLrXSmfJ5Nbfaen4TbH1n5Ozk7k/K4giF7jrc2vYDd3LrGhbznDxW7W0KzmNObz7f7P7O9HyZtJ9uJ5p160HDBajb085cr9vbifClIr9fsd/J/KWaRDBQbG5pPG5ajS04eS3am7vPjf6R9nImhbB/1Ehmmv8A3ULiIoz/AJsw9o/Zj/EFx1LadeUPqbPR3+4xa+pNa/DM+6P9/u4xkfou4m7tNV5J1H366PDERz97NbMtiL1c5zndVmI3nQt0pqanLwh491vtttZxb8Vun95OeeUc+IgNPeJPaAuvon/KXzJ/6gn/AOMY9/8AC6DLcVoo19WP0ZxqCdVfNYvp6lI58UPXtd9tNzaImvd3+k/34NlssUpYDBIGluINPXBIFxIxGOi6q46VqZnjh797t9zOnX0a2J8+X7z0PFEWD1pC4106Fm94tP4YxDtoaWppUjvdTjskk7VIiW7alVJtDdS1iXKdWvQOkt1BXhlnvq9A6YNQ7ArwSekRHknT9yvdp6UBygdavdpO7N6QOtO7X0tBbindnpZ22xOBqNzlrs01ViYw9WlqRKvKNsjYKYnTs2bV109O1uTw7zfaOjGLc3Gkma/2TfqXpis15vgamvpa2eCfHoxyFd6vla3Iq08qVQEIIiuSstIiCEUyC2yzhjs6tCMLq0uxG3asXmfJ6tvXS53lobPFiXHiCV55i/lD61dfQ87fSWmO1Qdf+F3kuc01Oj0V3G187fSfs0stll0yfwu8lidPV6PTXd7P9f0n7L2ZQsn1h/A/yU7nV6Osb7ZR+f6T9l4yhYyRWZ4A0NYb95IXXTpevjiJcdxudrrRiNS1Y9nhn4zD1cHyjBoAbNJdd6kcTfABduPU6Q+dG12PW0tEfylOr87Od5A+Kd5d0ja7PyrPz/ltPynyZtG528kVU7yXSuw28/lcjKPLm0SggvdQ6M4rFtS0+b26O22+nOYo4MltqvLaJl9Dv48oY7fanABrT6z/AOEa6a9S6aGlxzmeUPm9qb+dvpxWs/jt9I6/ZznsZCKm8mpN9fW05x0nzx0D6T8dMzM5lps2UmiPOzR6zy1takUaBnHGmLmjTgURZNk6G1NOZRkoFx0OOADt+u7HBEUZFyi9tYpah0ZzTnY3XX7Qvn7jRxOYfreyO0rXr3d58Y/Zstdo+C40q+lr6rC+Zdoq8VtRUZStxVzm4ZxV4WJ1EqVcMTqJerhO8SqYZm6Z6YTvBD0wd5J2yJhqNRrjtOa0n9VXPgzL1+ld3pTZ0LSI7LE0uaHzSgOdUV5sG9rWg6dZXurWKxh+T1tW2rebWc/KEDX5xbc+PGlBUi44Y3rTlEzE5hynOrfr8VmPB31J4o4uoLTzBVFSqCVQcpZUQiwIQFBZGyoOxSXSkq3BZw6ETC5EKLEijUSYFR0iVrHqOlZaoX63Ab1i2Xr05r52w2sniGMnYD5Lni8+T2Rr6FY9f6Sqktra0Fb7sFY0583O28pmIrnx9jVY5Km/ReuOpHg9u3vmfFUJi4vl1HNb9n7X662te7Spw1iH5Xe686+va/wj3Q51pdWocMAJG7Re08P+K6PKaQghjAQAxoBJwFTnE7TV1KbEWIzOIILeWvAaCGsP0vacdJd8Bo4msiclqzE4mMS6OWJM58c4xk/dv2uAFHcRd91Z1IzWXfaand61Z+HzK+UleWKv0dtTJ2Qk4rUQ5TdaImhXDHFMoA3QK7hVMxDUad7coaLNYZJDRkTidQF/Ys95VudtqRGZjEe0RkqY/RpvWZ1qvTXs3Vk/oWTSQs9/7HaOyrecn9CUxeFO+no6f9rrHOxX5NjGMgVi958nK+121fW1I+bJPCxuDieBXWOOecPDq+j19S2Z9xIDWRgOFa9i66ceL5u+1f8AHFep7ZaDJOXXuAIIHuEVGz813fIUse/nBS8Vziaj1icbjovI7Uhq1cTjOfcy2hma5w1OI8E82vyK6quQVQSqolUGHmisNCIygPNlBObKBjG0UznUqK8FztxeT26PczWItOJHmmH+1HEhc+K3R6Y0dCeWpBhZAcJG9oU7yejUbSk8rwtZk2v029oWZ1pjydq9nxP54aY8i1xlb3LE7iej0V7KrP54aG5HhF752jiAsxrak8qvRHZ22p431I+cHAsDMXF/ugnvwWojVn2Lns/T8+L3f3APyrZm/N2UHbJQdwqr3Np52ZntDbV/8ejHx/ssNpyi5+DGNH2G07yt10oq8mrvb6nhwxWPZDG037vFbl5KTm2ejdDLRjjsK5TXNoe3veDRvb2SpMjmxgtxA+JBrru1r2PzaQWmN7mF7R6jqlprmvYfaaDoB24bUFlse1jRGYQ0hxcC/wBoHAZzqZ1KYCtNJqixOPGFTJSXgOa0k9djSSKXGpF+CkRC2tNpzM5asoPrCLh6rxSgAw2D3irLNfCYbeYFc7cvNh+gmw7+67vUmJnlLrS9I9aM/FaydgwibvcSVz7qZ52l6K72lPV0oWjKbhg1o3D809Hq1Pa2rHq1rHw/lpseX7TE7OjkLDeKtuuOhbrpVryebW3+rrRi+Jj3QzSZQlcal5vV7qnRmd/ucY45VPnecXniStRSvRxtuda3O8/OVZftHatOM5nn4pzg1onDIZwN1VMtRXDNIc2Ru4ldNOHi3tszEFYKPdf7RvpqxN/BdHjaZYwyfNzi8Auo+lC6lQQ4VNDt2ojLlFtHHa51NwoPgkc3S3hSsfFkqq5hVBM5BKoPZDk/B9W//UaP5VcJkPQEOiM8X18GpgMMgRfVji5yYDjk9H9W3tf5pgeIy1FFz7gHc3mnMLZGvxF1RQG4rE82oYOjDRLGeJHc4BRSGE628HN80QBA44Cu4g+CKYWWT6t3Bp8lQSyRuLHDe0hTDdbzCyN9ViYw9VLxZss9ilePVYSNdwHaVzm8Q9unttW8ZrVc7JzmiskkbR7wc7gG1U7zPKHW20msZvaI+OZ+UMbQFt5q+HJfI6kbtylY/FDevb/BZdZZBzdKY1Ybze030uOn1uxd3xXdseSrNHFzrpb3MqxrYog1ppeXveHGjTWtNSDliNr+aaAM2e0TgNcAPUHNCMVxbQEjYosTicsLA5kzowPVYSGh2gHAtP0ag11Y1BokeENalotaZiMQtyk4ZrGDSQTXeT/MBwVnkzSM2iG/nLsR2V+K4YfZm8Z5g6Tb3UTEtcdS5+3uCYlO8oP6uqnDKTq06fUeJV4ZYnXqgp+qK8EszuK+wfVGkdqvAz6VHUHSx62+KcDE7uOqyBuf7DHP9xjneAV4GJ3UJOXMrnxyNpjnsc2naE4CN1Vy5p859RhgNy3WMQ8urfjtlplJLfVxdQHYNP63qubvQMjdIQ1ue7PeddXF2cGN30FToFUGe0ZAtDjVzCTgtYTLO7IEvUPcmDKt2Qpeo7sCCt2Rn9R3YmAnop/Vd2FTA7z+VtjGDnHcwpxGFL+WUGjO/AnEuGd/LYfRaeI/NOIwzyctpdDRx/qnEYZpeWE7sWRn3m18VOIw51tymJfagiB1xtzD2txUyrnyBpwFOJPigrzQgmaEFrZHjB7u007EDulri1tdbfVJ30u7lFicJnDq/wAXm1Thb72yc5s7wfgE4Wo17QInU4W43NuhpZ6tI1+aRTE5L7mbUmuFljm0HA3HZqP62rbzOxLZ2SRNjbLmOc6/nBSKUXZpzxe2hF4OsYUQB9mbFmMkcC6DOI5twc0lzq1DhjcG9iBpJmmshABfUmukbtA26QKDElEceW01fnY0wr470arMxOYMbc/WOAUxDXeW6h0t/W8FfBOO3UDan9YonFJDaj1+9EWRZ7/YDne4HO8FUbIci21/s2O0GuqGTxzVB0YeRWVXYWCX7wa3/cQqrbB8m+V3f3TN2vlhHcHk9yI2s+SbKjvabZx70pPgwoN8fyO26l9os42DnD/Kgsb8jNs02uAbmvPkorZZ/khtLcbdEf8A1P8A+SuUey5J8iY7HV7387M6oz82ga06GtJNNpremR6Q2RuruCZMFNgi6g7B5JkVnJUP1TfwjyTIU5Fs/wBSz8ITJhWcgWb6lvYEyYflN1llGMbx90qYaVlrhiDxBTAXOUEzkBqiYCqGEzlRM5FTOUBz0RM9BM/agLXVwv3XqjbDku1PFWWaZw1tieR3BBezk9bjhYrRxhePEJgaoeRuUzhYpeIA8SmEdKzcjcrjCxvvxBfFQ7wXouXRs3IPKryM6BjBcKl0NWjYGlVHfHyTZ3zluNMSGRAE7yXlMDZB8kVhHtWi0O3OjaD2MqmB0I/ksyWMWSu3yv8AhRMDfZvk7yS3+6Nd77pHeLkHQi5IZLbhYLPxiYfEFB0rPk2yx/N2eJvuxsHgEG5rgMKBA3OKCc5+gqps8qA1QSoQNcgKA1CA1CCZwQTPCCZ6CZ6D5bzzNI8PJdGAzoj9EcWjyQVustnOMTDvYFMKrdkixuxssR3sCYMl/Zywn+5xcGpiDKxnJewf4SPi0JiDMn/Zewf4WL8ITEGZOzkvYP8ACxfgaUwLmcmrCMIIv9Nh+CDTHkuytwhi4RtHwQXizQDCJn4Wj4ILGxMGEQ4BvkgtErW/QcNzSf8AaEFrbUw6Rx/NBaJAcKIGEqBw8oGEigsB3IHG9FMEDV2lA2eNaAiTagPPbkE6Ru7UwCLTsTBlOlbO5TBkelhXBkelbUwZEWlTBkeeTAmeqCHHWgYHaoGFdaCwAqCFw1jtQfJ+mM0M7fyAXRkemDqtHA+aB22w0uzb9lQgdtrdqFNlxQW9KOmo4VRRFq+1+uKC5sv6KCwS+aBg9BYJBpKAh4TIYSbaIHbaKaVATaQdXHSrgK6dmkBQVulYcCR7rnN7gaK4Fb5XYttMjdn7tw72V71MC0WybRM37zK17HBMCxmU5Rcebd2t7qFMA+mHA3xje1wPjRMAjLY0tI7PgUwI7LbOsRvafJMAenI/rG8SqCMssODwdxQT0q3WgcZVH9UwgjK7dY7UwGGVW6+yqinGVW60wIcrsGJHEpgT05F1mpgD9oohp7AmAruU0Y/NMGSnlSzYmDJf2rGig3UCcJlWeVO/tV4UyB5TbCmDJTymVwZfPm27as5U4ygmTBxlBMhxlTamQzcrDWirPTG1MoX0wNGOxARlj7R7fNAfTjh9LtHkgHp860AOX9qKX9od6AftFqd3oAeUD0yip2W3FMhfTL0yJ6YfrTIAyq/WUyCMpyazcmQfScnWTIHpF/WTJhBbHnT2JkO21O/qSO9UA2o6S3fcfgoD0xoFM4/dqPAoCLedBdxNfEfFA3pI9YeKAHKjqe32CiBPSB1n8R8ECm3uVE6edfwTKJ03b3oGFr2oD0koILUgbpSA9L2qhumbUHkzPtXNoekbUE6RtRUNp2oB0jagnSNqIPPFBOeOtMic8daZBEqZUeeTInOJkQvrigl39LkBDtp7UDsft7UMLBINaqYMJxrUXAc+FUEWr9FADadqAdJ2oJ0pBOkoAbUdaCc+gnPbUBE6A8+qCJ0QeeQQyIJX9C5AwcdZ7UDCQ60A51yCCYoG50oYf//Z" },
            { name: "BMW M4 Competition White", brand: "BMW", price: 78000, category: "Luxury", stock: 5, image: "https://images.unsplash.com/photo-1555215695-3004980ad54e?w=600" },
            { name: "BMW M4 Competition", brand: "BMW", price: 76000, category: "Luxury", stock: 8, image: "https://maxtondesign.com/data/include/cms/our-projects/Carbon-BMW-M4-Competition/bmwm4_Front.webp" },
            { name: "Range Rover Sport", brand: "Land Rover", price: 79000, category: "SUV", stock: 2, image: "https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=600" },
            { name: "Range Rover Sport", brand: "Land Rover", price: 76000, category: "SUV", stock: 12, image: "https://img.autoabc.lv/Land-Rover-Range-Rover-Sport/Land-Rover-Range-Rover-Sport_2009_Apvidus_15111112115_1.jpg" },
            { name: "Audi Q8 e-tron", brand: "Audi", price: 88000, category: "Electric", stock: 8, image: "https://www.topgear.com/sites/default/files/2024/02/11426-0K2A6582.jpg?w=1290&h=726" },
            { name: "Audi Q8 e-tron", brand: "Audi", price: 80000, category: "Electric", stock: 80, image: "https://i0.wp.com/practicalmotoring.com.au/wp-content/uploads/2022/11/2023-Audi-Q8-e-tron-facelift-2.jpg?fit=1845%2C1044&ssl=1" },
            { name: "Volvo XC90", brand: "Volvo", price: 90000, category: "SUV", stock: 4, image: "https://www.topgear.com/sites/default/files/2024/02/294655_XC90_Recharge_T8_AWD_Denim_Blue.jpg?w=1290&h=726" },
            { name: "Volvo XC90 Red", brand: "Volvo", price: 91000, category: "SUV", stock: 12, image: "https://impx.hwntcdn.com/i/raw:1/plain/https://composer.hwntcdn.com/1179/used/volvo-xc90-20-d5-r-design-geartronic-4wd-euro-6-s-s-5dr-77947-cvaogyn4.jpg" },
            { name: "Bentley Bentayga 2026", brand: "Bentley", price: 98000, category: "Luxury", stock: 1, image: "https://www.topgear.com/sites/default/files/2024/02/Bentayga%20on%20road%20-%205.jpg?w=1290&h=726" },
            { name: "Bentley Bentayga Gold", brand: "Bentley", price: 100000, category: "Luxury", stock: 10, image: "https://car-images.bauersecure.com/wp-images/12882/079-bentley-bentayga-speed.jpg" },
            { name: "Bentley Bentayga 2025", brand: "Bentley", price: 70000, category: "Luxury", stock: 12, image: "https://imgd.aeplcdn.com/1056x594/n/3g6oh4a_1520659.jpg?q=80" }
        ];

        // Load from LocalStorage or use defaults
        let carInventory = JSON.parse(localStorage.getItem('myProducts'));
        if (!carInventory || carInventory.length === 0) {
            carInventory = defaultProducts;
            localStorage.setItem('myProducts', JSON.stringify(carInventory));
        }

        let editIndex = -1;
        let currentFilter = 'All';
        const carListBody = document.getElementById('car-list-body');

        // --- 2. RENDER LOGIC ---
        function renderCars() {
            carListBody.innerHTML = '';
            const filtered = currentFilter === 'All' ? carInventory : carInventory.filter(c => c.category === currentFilter);

            filtered.forEach((car, index) => {
                const originalIndex = carInventory.indexOf(car);
                const isLow = car.stock <= 2;
                carListBody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td><img src="${car.image}" class="img-preview" onerror="this.src='https://via.placeholder.com/50'"></td>
                        <td><strong>${car.name}</strong></td>
                        <td>${car.brand}</td>
                        <td>${car.category}</td>
                        <td>$${Number(car.price).toLocaleString()}</td>
                        <td>${car.stock}</td>
                        <td><span class="badge ${isLow ? 'lowstock' : 'instock'}">${isLow ? 'Low Stock' : 'In Stock'}</span></td>
                        <td class="action-td">
                            <button onclick="editCar(${originalIndex})" style="border:none; background:none; color:#3b82f6; cursor:pointer;"><i class="fa-solid fa-pen"></i></button>
                            <button onclick="deleteCar(${originalIndex})" style="border:none; background:none; color:#ef4444; cursor:pointer; margin-left:10px;"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        }

        // --- 3. SAVE/EDIT/DELETE ---
        function saveCar() {
            const name = document.getElementById('p-name').value;
            const brand = document.getElementById('p-brand').value;
            const cat = document.getElementById('p-cat').value;
            const price = document.getElementById('p-price').value;
            const stock = document.getElementById('p-stock').value;
            const image = document.getElementById('p-image').value;

            if (!name || !brand || !cat || !price || !stock) {
                alert("Please fill all required fields!");
                return;
            }

            const carData = { 
                name, brand, category: cat, price, stock, 
                image: image || 'https://via.placeholder.com/150' 
            };

            if (editIndex === -1) {
                carInventory.push(carData);
            } else {
                carInventory[editIndex] = carData;
                editIndex = -1;
            }

            localStorage.setItem('myProducts', JSON.stringify(carInventory));
            renderCars();
            toggleModal();
        }

        window.editCar = function(index) {
            editIndex = index;
            const car = carInventory[index];
            document.getElementById('p-name').value = car.name;
            document.getElementById('p-brand').value = car.brand;
            document.getElementById('p-cat').value = car.category;
            document.getElementById('p-price').value = car.price;
            document.getElementById('p-stock').value = car.stock;
            document.getElementById('p-image').value = car.image;
            updatePreview();
            document.getElementById('modalTitle').innerText = "Edit Vehicle";
            document.getElementById('save-btn').innerText = "Update Vehicle";
            toggleModal();
        }

        window.deleteCar = function(index) {
            if(confirm("Delete this vehicle?")) {
                carInventory.splice(index, 1);
                localStorage.setItem('myProducts', JSON.stringify(carInventory));
                renderCars();
            }
        }

        // --- 4. HELPERS ---
        function filterCars(cat) {
            currentFilter = cat;
            renderCars();
        }

        function toggleModal() {
            const modal = document.getElementById('productModal');
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
                editIndex = -1;
                document.querySelectorAll('.modal-content input').forEach(i => i.value = '');
                document.getElementById('p-cat').value = "";
                document.getElementById('modalTitle').innerText = "Add New Vehicle";
                document.getElementById('save-btn').innerText = "Save Vehicle";
                updatePreview();
            } else {
                modal.style.display = 'flex';
            }
        }

        function updatePreview() {
            const url = document.getElementById('p-image').value;
            document.getElementById('p-preview').src = url || 'https://via.placeholder.com/150x80?text=No+Image';
        }

        function searchCars() {
            const term = document.getElementById('carSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#car-list-body tr');
            rows.forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(term) ? '' : 'none';
            });
        }

        // Logout Animation
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if(confirm('Logout from system?')) {
                const overlay = document.getElementById('logoutLoading');
                const bar = document.getElementById('p-bar-fill');
                overlay.style.display = 'flex';
                setTimeout(() => bar.style.width = '100%', 100);
                setTimeout(() => window.location.href = '../login.html', 1200);
            }
        });

        // Initialize table
        renderCars();
    </script>
</body>
</html>