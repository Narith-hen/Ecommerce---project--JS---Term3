<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Order History - AutoDrive Admin</title>
        <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/product.css">

        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    </head>
    <body>

        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="logo">
                <i class="fa-solid fa-car-side"></i> <span>
                    Admin Order</span>
            </div>
            <ul class="nav-links">
                <li><a href="../admin.html"><i class="fa-solid fa-house"></i>
                        Dashboard</a></li>
                <li><a href="product.html"><i class="fa-solid fa-box"></i>
                        Products</a></li>
                <li class="active"><a href="order.html"><i
                            class="fa-solid fa-receipt"></i> Orders</a></li>
                <li><a href="../page/customer.html"><i
                            class="fa-solid fa-users"></i> Customers</a></li>
                <li><a href="setting.html"><i class="fa-solid fa-gear"></i>
                        Settings</a></li>
            </ul>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content">

            <!-- HEADER -->
            <header>
            <div class="search-bar">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="text" id="carSearch" placeholder="Search by model or brand..." onkeyup="searchCars()">
            </div>
            <div class="user-info">
                <i class="fa-solid fa-bell" style="margin-right: 15px; color: #64748b; cursor: pointer;"></i>
                <div class="profile">
                    <div class="user-avatar-premium">N</div>
                    <div class="user-info-text">
                        <span class="name">Narith</span>
                        <span class="role">Administrator</span>
                    </div>
                </div>
            </div>
        </header>

            <header>
                <h2>Order Management</h2>
            </header>

            <!-- TABLE -->
            <section class="management-section">
                <table class="product-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Car Model</th>
                            <th>Price</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="order-list-body"></tbody>
                </table>
            </section>

        </main>

        <!-- MODAL -->
        <div id="orderModal" style="
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.5);
    z-index:1000;
    justify-content:center;
    align-items:center;
">
            <div style="
        background:#1e293b;
        padding:30px;
        width:450px;
        border-radius:12px;
        position:relative;
    ">
                <span onclick="closeOrderModal()" style="
            position:absolute;
            top:15px;
            right:20px;
            font-size:24px;
            cursor:pointer;
        ">&times;</span>

                <h2>Order Details</h2>
                <div id="modal-body" style="margin-top:20px;"></div>

                <!-- ACTION BUTTONS -->
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button onclick="printOrder()" style="
                flex:1;
                padding:10px;
                background:#16a34a;
                color:white;
                border:none;
                border-radius:6px;
                cursor:pointer;
            ">
                        <i class="fa-solid fa-print"></i> Print
                    </button>

                    <button onclick="deleteOrder()" style="
                flex:1;
                padding:10px;
                background:#dc2626;
                color:white;
                border:none;
                border-radius:6px;
                cursor:pointer;
            ">
                        <i class="fa-solid fa-trash"></i> Delete
                    </button>

                    <button onclick="closeOrderModal()" style="
                flex:1;
                padding:10px;
                background:#6b7280;
                color:white;
                border:none;
                border-radius:6px;
                cursor:pointer;
            ">
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- SCRIPT -->
        <script>
        let allOrders = JSON.parse(localStorage.getItem('myOrders')) || [];

        function renderOrders(filterData = null) {
            const displayData = filterData || allOrders;
            const body = document.getElementById('order-list-body');
            
            if (displayData.length === 0) {
                body.innerHTML = '<tr><td colspan="6" style="text-align:center;">No orders found</td></tr>';
                return;
            }

            body.innerHTML = displayData.map((order) => `
                <tr>
                    <td>#ORD-${order.id}</td>
                    <td>
                        <strong>${order.name}</strong><br>
                        <small>Buyer: ${order.customerName || 'Guest'}</small>
                    </td>
                    <td>$${Number(order.price).toLocaleString()}</td>
                    <td>${order.date}</td>
                    <td><span class="status-badge active">Completed</span></td>
                    <td>
                        <button onclick="viewOrderDetail(${order.id})" style="background:#4f46e5; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">
                            <i class="fa-solid fa-eye"></i> View
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        

        // SEARCH LOGIC
        document.querySelector('.search-bar input').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allOrders.filter(o => 
                o.name.toLowerCase().includes(term) || 
                o.customerName.toLowerCase().includes(term) ||
                o.id.toString().includes(term)
            );
            renderOrders(filtered);
        });

        // VIEW ORDER (Using ID instead of Index)
        function viewOrderDetail(id) {
            const order = allOrders.find(o => o.id === id);
            if (!order) return;

            currentOrderId = id; 

            // Added 'color: white' for on-screen visibility
            document.getElementById('modal-body').innerHTML = `
                <table style="width:100%; border-collapse:collapse; color: white; font-size: 1.1em;">
                    <tr style="border-bottom: 1px solid #334155;"><td style="padding:12px 0;"><strong>Order ID</strong></td><td style="text-align:right;">#${order.id}</td></tr>
                    <tr style="border-bottom: 1px solid #334155;"><td style="padding:12px 0;"><strong>Customer</strong></td><td style="text-align:right;">${order.customerName}</td></tr>
                    <tr style="border-bottom: 1px solid #334155;"><td style="padding:12px 0;"><strong>Car Model</strong></td><td style="text-align:right;">${order.name}</td></tr>
                    <tr style="border-bottom: 1px solid #334155;"><td style="padding:12px 0;"><strong>Price</strong></td><td style="text-align:right; color:#4ade80; font-weight:bold;">$${Number(order.price).toLocaleString()}</td></tr>
                    <tr><td style="padding:12px 0;"><strong>Date</strong></td><td style="text-align:right;">${order.date}</td></tr>
                </table>
            `;
            document.getElementById('orderModal').style.display = 'flex';
        }

        

        // DELETE ORDER (Using ID)
        function deleteOrder() {
            if (!confirm("Permanently delete this order record?")) return;

            allOrders = allOrders.filter(o => o.id !== currentOrderId);
            localStorage.setItem('myOrders', JSON.stringify(allOrders));
            
            closeOrderModal();
            renderOrders();
        }

        function closeOrderModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        // Initial Run
        renderOrders();
        </script>

    </body>
</html>
